{% load static %}
<!DOCTYPE html lang="es">
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet" />

  <!-- CSS padre para todo el sistema -->
  <link rel="stylesheet" href="{% static 'css/pharmacontrol.css' %}">
</head>
<body>

<!-- ===== SIDEBAR ===== -->
<div class="submenu">
  <div class="side-bar">
    <div>
      <div class="logo">Pharmacontrol</div>
      <div class="list-menu1">
        <div class="content active">
          <i class="bi bi-house"></i>
          <div class="text"><a href="{% url 'medicamentos' %}">Dashboard</a></div>
        </div>
        <div class="content"><i class="bi bi-box"></i><div class="text"><a href="{% url 'inventory' %}">Inventario</a></div></div>
        <div class="content"><i class="bi bi-files"></i><div class="text"><a href="{% url 'reports' %}">Reportes</a></div></div>
        {% comment %} <div class="content"><i class="bi bi-people"></i><div class="text"><a href="{% url 'users' %}">Usuarios</a></div></div> {% endcomment %}
        <div class="content"><i class="bi bi-truck"></i><div class="text"><a href="{% url 'orders' %}">Pedidos</a></div></div>
        <div class="content"><i class="bi bi-cart-check"></i><div class="text"><a href="{% url 'suppliers' %}">Proveedores</a></div></div>
        <div class="content"><i class="bi bi-cart3"></i><div class="text"><a href="{% url 'carrito' %}">Carrito</a></div></div>
      </div>
    </div>

    <div class="list-menu-parent">
      <div class="list-menu8">
        <div class="content"><i class="bi bi-gear"></i><div class="text"><a href="{% url 'settings' %}">Configuración</a></div></div>
      </div>
      <div class="list-menu8">
        <div class="content">
          <form method="post" action="{% url 'logout' %}">{% csrf_token %}
            <button type="submit"><i class="bi bi-door-open"></i>Cerrar sesión</button>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- ===== CONTENIDO ===== -->
<div class="contenido">

  <!-- Header + filtros -->
  <div class="page-header">
    <div class="title">Dashboard</div>
    <div class="filters">
      <select class="form-select" id="filtroPeriodo">
        <option value="30">Últimos 30 días</option>
        <option value="90">Últimos 3 meses</option>
        <option value="365">Último año</option>
      </select>
      <input class="form-control" id="buscador" placeholder="Buscar medicamento o categoría..." />
    </div>
  </div>

  <!-- KPIs -->
  <div class="kpi-grid">
    <div class="kpi"><div class="kpi-label">Total Medicamentos</div><div id="kpi-total" class="kpi-value">0</div><div class="kpi-trend trend-up">Operativo</div></div>
    <div class="kpi"><div class="kpi-label">Stock Crítico (&lt; 10)</div><div id="kpi-criticos" class="kpi-value">0</div><div class="kpi-trend trend-warn">Reponer pronto</div></div>
    <div class="kpi"><div class="kpi-label">Caducados</div><div id="kpi-caducados" class="kpi-value">0</div><div class="kpi-trend trend-down">Revisión urgente</div></div>
    <div class="kpi"><div class="kpi-label">Órdenes Pendientes</div><div id="kpi-ordenes" class="kpi-value">0</div><div class="kpi-trend">En seguimiento</div></div>
  </div>

  <!-- Gráficas -->
  <div class="cards-grid">
    <div class="card span-3">
      <h4>Resumen General</h4>
      <div class="chart-wrap"><canvas id="graficaResumen"></canvas></div>
    </div>

    <div class="card span-4">
      <h4>Stock por Medicamento</h4>
      <div class="chart-wrap"><canvas id="graficaStock"></canvas></div>
    </div>

    <div class="card span-5">
      <h4>Ventas Mensuales</h4>
      <div class="chart-wrap"><canvas id="graficaVentas"></canvas></div>
    </div>

    <div class="card span-4">
      <h4>Medicamentos por Categoría</h4>
      <div class="chart-wrap"><canvas id="graficaCategorias"></canvas></div>
    </div>

    <div class="card span-4">
      <h4>Rotación (salidas) por Categoría</h4>
      <div class="chart-wrap"><canvas id="graficaRotacion"></canvas></div>
    </div>

    <div class="card span-4">
      <h4>Vencimientos Próximos (30/60/90 días)</h4>
      <div class="chart-wrap"><canvas id="graficaVencimientos"></canvas></div>
    </div>
  </div>

  <!-- Tabla -->
  <div class="table-card">
    <h4 class="mb-2" style="color:var(--brand)">Lista de Medicamentos</h4>
    <div class="table-responsive" style="max-height: 420px; overflow:auto;">
      <table class="table table-striped table-bordered align-middle">
        <thead class="table-light">
          <tr>
            <th>ID</th><th>Nombre</th><th>Lote</th><th>Caducidad</th><th>Proveedor</th><th>Stock</th><th>Precio</th><th>Categoría</th>
          </tr>
        </thead>
        <tbody id="tabla-meds"></tbody>
      </table>
    </div>
  </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    window.__DATA__ = {{ chart_data_json|safe }};
    window.__MEDS__ = {{ meds_json|safe }};  /* listado completo */
  </script>
  <script src="{% static 'js/dashboard.js' %}"></script>
</body>
</html>
